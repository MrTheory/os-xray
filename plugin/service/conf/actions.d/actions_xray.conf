[start]
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php start
parameters:
type:script_output
message:Starting Xray

[stop]
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php stop
parameters:
type:script_output
message:Stopping Xray

[restart]
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php restart
parameters:
type:script_output
message:Restarting Xray

[reconfigure]
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php reconfigure
parameters:
type:script_output
message:Reconfiguring Xray

[status]
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php status
parameters:
type:script_output
message:Xray status

[log]
command:/usr/bin/tail
parameters:-n 150 /tmp/xray_syshook.log
type:script_output
message:Xray log

[xraylog]
# E3: лог xray-core (stderr/stdout демона, файл появился после BUG-7 fix).
# Ротация через /etc/newsyslog.conf.d/xray.conf (BUG-11 fix).
command:/usr/bin/tail
parameters:-n 200 /var/log/xray-core.log
type:script_output
message:Xray core log

[testconnect]
# BUG-4 FIX: порт читается из config.xml через PHP-скрипт.
# До исправления: 127.0.0.1:10808 был захардкожен — при смене порта в GUI тест не работал.
command:/usr/local/opnsense/scripts/Xray/xray-testconnect.php
parameters:
type:script_output
message:Xray test connection

[validate]
# E5: сухой прогон конфига без применения: генерирует config.json и запускает xray-core -test.
# Не вызывает stop/start — только валидация. Выводит "OK" или детальные ошибки xray-core.
command:/usr/local/opnsense/scripts/Xray/xray-service-control.php
parameters:validate
type:script_output
message:Validate Xray config

[ifstats]
# E4: статистика TUN-интерфейса для панели Diagnostics.
# Имя интерфейса читается из config.xml через PHP-скрипт (ifstats.php).
command:/usr/local/opnsense/scripts/Xray/xray-ifstats.php
parameters:
type:script_output
message:Xray TUN interface stats

[watchdog]
# E1: watchdog — запускается cron каждую минуту.
# Проверяет xray-core и tun2socks; при падении одного — перезапускает оба.
# Если watchdog_enabled=0 в General — завершается без действий.
command:/usr/local/opnsense/scripts/Xray/xray-watchdog.php
parameters:
type:script_output
message:Xray watchdog check
